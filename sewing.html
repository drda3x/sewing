<!DOCTYPE html>
<html>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<head>
    <title>Расчет выкройки</title>
    <link rel="stylesheet" href="sewing.css"/>
    <script type="text/javascript" src="jquery-2.0.3.min.js"></script>
    <script type="text/javascript">
        window.onload = function () {

            var form, workPlaces, linkViews, workPlaceViews;

            form = (function () {
                var arr = $('.inp').children().children('input'),
                        o = {};
                for (var i = 0; i < arr.length; i++) {
                    currObj = $(arr[i]);
                    o[currObj.attr('id').toLowerCase()] = currObj;
                }
                return o;
            })();
            workPlaces = $('.workplace').children();
            linkViews = {
                p:[form.posh, form.pog, form.pot, form.pob, form.shg, form.tsg, form.vg, form.dpt, form.vpkp, form.shs, form.dst, form.dst1, form.vpks, form.vb, form.shpl, form.op, form.dr, form.di],
                b:[form.di, form.ob],
                u:[form.pot, form.pob, form.di]
            };
            workPlaceViews = {
                p:[],
                b:[],
                u:[]
            }

            // Припуски
            var PG = PSPR = 2.5,
                    PT = PB = 1.5,
                    PSHGS = PTSG = PVG = 1,
                    POP = 3.5;

            // Формулы для платья...
            var dress = {
                refreshParams:function () {
                    // Размеры с неизменяемыми формулами
                    this.params = {
                        an:'АН: '+form.di.__myValue,
                        at:'АТ: '+form.dst.__myValue,
                        tg:'ТГ: '+(form.vb.__myValue - PSPR),
                        tb:'ТБ: 17-20',
                        g1g3:'Г1-Г3: '+(form.pog.__myValue / 2 - 3).toFixed(1),
                        pp1:'П-П1: '+(form.dst1.__myValue - form.dst.__myValue),
                        gg1: 'Г-Г1: '+form.pog.__myValue+' ('+(form.pog.__myValue + PG)+')',
                        gg2: 'Г-Г2: '+form.shs.__myValue+' ('+(form.shs.__myValue + (PG / 4)).toFixed(1)+')',
                        ap: 'АП: '+form.posh.__myValue+' ('+(form.posh.__myValue / 3 + PSHGS).toFixed(1)+')'
                    };

                    var main_frm = form.pog.__myValue + PG - form.pot.__myValue + PT;

                    // Вытачки
                    this.tuck = {
                        side:'Боковая вытачка: ' + (main_frm/2).toFixed(1),
                        back:'Вытачка на спинке: ' + (main_frm/2 * 0.6).toFixed(1),
                        front:'Вытачка на полочке: ' + (main_frm/2 * 0.4).toFixed(1),
                        t2t3:'Ширина спинки по линии талии: ' + (main_frm/4).toFixed(1),
                        b:'Точка "b": ' + (main_frm/6).toFixed(1),
                        b2b3:'Б2-Б3: ' + ((form.pob.__myValue + PB - form.pog.__myValue + PG)/2).toFixed(1),
                        n2n3:'N2-N3: ' + ((form.pob.__myValue + PB - form.pog.__myValue + PG)/2).toFixed(1)
                    };
                    // Полочка
                    this.front = {
                        t1a2:'Т1-А2: '+form.dpt.__myValue,
                        a2a3:'А2-А3: '+(form.posh.__myValue / 3 + 1).toFixed(1),
                        a2a4:'А2-А4: '+(form.posh.__myValue / 3 + 2).toFixed(1),
                        g1g4:'Г1-Г4: '+(form.tsg.__myValue + PTSG),
                        a3g5:'А3-Г5: '+(form.vg.__myValue + PVG),
                        a3a5:'А3-А5: 5',
                        oo1:'О-О1: 6',
                        spl_a3a5:'ШПЛ-А3А5: '+(form.shpl.__myValue - form.vg.__myValue + PVG),
                        a1:'А1: 3',
                        a2:'А2: 9'
                    };
                    this.aaa = {};
                }
            }

            skirt = {
                refreshParams:function() {
                    this.frontParams = {
                        lb: 'Перед',
                        tt1: 'Т-Т1: '+form.pob.__myValue/2,
                        tb:'ТБ: 17-20',
                        tt2: 'Т-Т2: '+ (form.pot.__myValue/2 + (form.pob.__myValue/2 - form.pot.__myValue/2)),
                        t3: 'Т3: '+ (form.pot.__myValue/2 + (form.pob.__myValue/2 - form.pot.__myValue/2))/2,
                        b3: 'Б3: 5'
                    };
                    this.backParams = {
                        lb: 'Зад',
                        tt1: 'Т-Т1: '+(form.pob.__myValue/2+1),
                        nn1: 'N-N1: '+(form.pob.__myValue/2+1),
                        tb:'ТБ: 17-20',
                        tt2: 'Т-Т2: ' + (form.pot.__myValue/2 + (form.pob.__myValue/2 - form.pot.__myValue/2)),
                        t3: 'Т3: '+ (form.pot.__myValue/2 + (form.pob.__myValue/2 - form.pot.__myValue/2))/2,
                        t4: '8-10'
                    }
                }
            }

            /*
             * Запуск расчета выкройки
             */
            function calcParams(obj) {
                //Сбор данных
                var w = $('.nav_link.active').attr('id'),
                        currentView = linkViews[w];

                w="p";

                for (var i = 0; i < currentView.length; i++) {
                    currentView[i].__myValue = currentView[i].val() * 1;
                }

                // Расчет
                var o, o1, target = $('.workplace');
                target.empty();

                obj.refreshParams();

                for (key in obj) {
                    o = obj[key];
                    if (typeof o === "object") {
                        for (key1 in o) {
                            target.append('<div class="formula ' + key1 + '">'+o[key1]+'</div>');
                        }
                    }
                }
            }

            // Функция для обновления экрана
            function refreshView(o){
                o.siblings().removeClass('active');
                o.addClass('active');

                // TODO продумать дизайн активной и не активной ссылки

                $('.inp').children().addClass('inp_invisible');
                var viewList = linkViews[o.attr('id')];
                for (var i = 0; i < viewList.length; i++) {
                    console.log(viewList[i]);
                    viewList[i].parent().removeClass('inp_invisible');
                }
            }

            refreshView($('.nav_link#p'));

            $('#calc').click(function () {
                var id = $('.nav_link.active').attr('id');
                switch(id) {
                    /*case 'b': calcParams(pants);
                        break;*/
                    case 'u': calcParams(skirt);
                        break;
                    case 'p': calcParams(dress);
                        break;
                }
                return false;
            });

            $('.nav_link').click(function () {
                refreshView($(this));
                $('.workplace').empty();
                return false;
            });
        }
    </script>
</head>
<body>
<div id="left">
    <div class="inp">
        <div class="inp_container">
            <div class="inp_label">ПОШ</div>
            <input type="text" id="POSH"/></div>
        <div class="inp_container">
            <div class="inp_label">ПОГ</div>
            <input type="text" id="POG"/></div>
        <div class="inp_container">
            <div class="inp_label">ПОТ</div>
            <input type="text" id="POT"/></div>
        <div class="inp_container">
            <div class="inp_label">ПОБ</div>
            <input type="text" id="POB"/></div>
        <div class="inp_container">
            <div class="inp_label">ШГ</div>
            <input type="text" id="SHG"/></div>
        <div class="inp_container">
            <div class="inp_label">ЦГ</div>
            <input type="text" id="TSG"/></div>
        <div class="inp_container">
            <div class="inp_label">ВГ</div>
            <input type="text" id="VG"/></div>
        <div class="inp_container">
            <div class="inp_label">ДПТ</div>
            <input type="text" id="DPT"/></div>
        <div class="inp_container">
            <div class="inp_label">ВПКП</div>
            <input type="text" id="VPKP"/></div>
        <div class="inp_container">
            <div class="inp_label">ШС</div>
            <input type="text" id="SHS"/></div>
        <div class="inp_container">
            <div class="inp_label">ДСТ</div>
            <input type="text" id="DST"/></div>
        <div class="inp_container">
            <div class="inp_label">ДСТ-1</div>
            <input type="text" id="DST1"/></div>
        <div class="inp_container">
            <div class="inp_label">ВПКС</div>
            <input type="text" id="VPKS"/></div>
        <div class="inp_container">
            <div class="inp_label">ШПЛ</div>
            <input type="text" id="SHPL"/></div>
        <div class="inp_container">
            <div class="inp_label">ВБ</div>
            <input type="text" id="VB"/></div>
        <div class="inp_container">
            <div class="inp_label">ОП</div>
            <input type="text" id="OP"/></div>
        <div class="inp_container">
            <div class="inp_label">ОЗ</div>
            <input type="text" id="OZ"/></div>
        <div class="inp_container">
            <div class="inp_label">ДР</div>
            <input type="text" id="DR"/></div>
        <div class="inp_container">
            <div class="inp_label">ДИ</div>
            <input type="text" id="DI"/></div>
    </div>
</div>
<div id="right">
    <div class="nav">
        <a id="b" class="nav_link" href="">Брюки</a>
        <a id="u" class="nav_link" href="">Юбка</a>
        <a id="p" class="nav_link" href="">Платье </a>
    </div>
    <div class="workplace">
        <!-- Сюда результат!!! -->
    </div>
    <div><a id="calc" href="">Рассчитать</a></div>
</div>
</body>
</html>